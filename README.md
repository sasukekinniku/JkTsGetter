# JkTsGetter

## このソフトについて
『ニコ生新配信録画ツール(仮』(https://com.nicovideo.jp/community/co2414037) を使って、ニコニコ実況の生放送タイムシフトを取得する Windows 用のコマンドラインツールです。前日以前だけでなく、当日の過去ログも取得できるます。

『ニコニコ実況過去ログAPI』(https://jikkyo.tsukumijima.net/) にも対応しており、生放送に移行する以前の過去ログも取得できます。

GUI で操作できるフロントエンド JkTsGetterTool が付属します。

## 初期設定
このソフトを起動するには .NET Framework 4.7.2 が必要です。起動できない場合は、これがインストールできているか確認してください。

https://support.microsoft.com/ja-jp/help/4054530/microsoft-net-framework-4-7-2-offline-installer-for-windows からインストールできます。

このソフトで実況生放送のタイムシフトを取得するには、『ニコ生新配信録画ツール(仮』が必要です。

https://com.nicovideo.jp/community/co2414037 から最新版をダウンロードしてください。また、プレミアム会員、もしくは一般会員でタイムシフト予約をして、過去の実況生放送を取得できるようにしたニコニコアカウントが必要となります。『ニコニコ実況過去ログAPI』からの取得する場合は、ニコニコアカウントやツールは必要ありません。

『ニコ生新配信録画ツール(仮』を起動し、メニューの [ツール] - [アカウント] を選択し、ニコニコにログインする設定を行ってください。その他の項目は、設定によっては変更することでうまく取得できなくなる可能性があります。

このツールに含まれる JkTsGetter.exe, JkTsGetter.ini, JkTsGetterTool.exe は『ニコ生新配信録画ツール(仮』と同じフォルダに入れてください。もしくは、別の場所に置いて、JkTsGetter.ini を書き換えて『ニコ生新配信録画ツール(仮.exe』の場所を指定してください。

## 使い方

### 過去ログ取得
```
JkTsGetter チャンネル 取得開始日時 取得終了日時 [オプション...]
```
- 指定チャンネルの過去ログを取得します。
- チャンネルは、jk1(NHK), jk2(Eテレ) などのように指定します。jkをつけずに 1, 2 などとしてもOKです。
- 日時はUnix時間か、yyyymmddhhmmss の14桁 (2020年1月2日3時15分30秒なら、20200102031530) で指定します。

### タイムシフト1日分取得
```
JkTsGetter チャンネル 取得年月日 -ts [オプション...]
```
- 指定チャンネル、指定日のニコ生タイムシフトコメント (午前4時～翌午前4時の24時間分) を取得します。
- 年月日は yyyymmdd の8桁 (2020年1月2日なら、20200102) で指定します。

### 全タイムシフト取得
```
JkTsGetter -all [オプション...]
```
- 現在取得可能な、すべての実況公式ニコ生タイムシフトを取得します。

### 全タイムシフト取得 (キャッシュフォルダ)
```
JkTsGetter -all -cache [オプション...]
```
- 取得可能なすべての実況公式ニコ生タイムシフトを取得します。
- JkTsGetter.ini で指定したキャッシュフォルダに保存し、チャンネルごとにサブフォルダを作成し、上書きをおこないません。

### tsファイルから過去ログ取得
```
JkTsGetter tsファイル [オプション...]
```
- tsファイルからチャンネル、開始時間、終了時間を取得して、過去ログを取得します。
- 開始日時、チャンネルはtsファイルの内容から解析し、終了時間はファイルの最終更新日時から取得します。
- tsファイルから情報を

### コメントファイルをマージ
```
JkTsGetter xmlファイル1 xmlファイル2 -merge [オプション...]
```
- 2つのコメントxmlファイルを、1つのファイルにマージ (時間順に並べ替えて統合) します。

### コマンドラインオプション

#### `-ts`
指定チャンネルの特定日のタイムシフトを1日分取得します。

### `-all`
取得可能なすべての実況ニコ生タイムシフトを取得します。

#### `-m 秒`
取得日時の前後を指定秒だけ広げます。

#### `-s 秒`
取得日時の前部分を指定秒だけ広げます。

#### `-e 秒`
取得日時の後部分を指定秒だけ広げます。

#### `-f フォルダ/ファイルパス`
出力するフォルダやファイル名、パスを指定します。フォルダを指定した場合、その中にデフォルトのファイル名で出力します。指定しなかった場合、カレントフォルダにデフォルトのファイル名で出力します。

#### `-d`
チャンネル名と同じ名前のサブフォルダを作成し、その中に過去ログを保存します。

#### `-v`
保存したいファイルと同名のファイルがある場合に、上書きを行いません。

#### `-old`
日時にかかわらず、つねにニコニコ実況過去ログAPIから取りに行きます。

## キャッシュ機能について
JkCommentGetter.ini を書き換えて設定を有効にすると、キャッシュ機能が利用できます。

これは、ニコ生のタイムシフトをダウンロードすると、その日1日分 (4時～翌4時) 全部のコメントをキャッシュフォルダに保存し、該当の時間帯をもういちど取得のときに、自動で再利用ができる機能です。

取得の際に自動保存、自動利用するほか、コマンドラインオプションに「-all -cache」をつけることによって、現在取得できるタイムシフトをすべてキャッシュフォルダにダウンロードすることもできます。

その日のログがまだタイムシフト化されていない場合 (追っかけ再生の取得となった場合) や、『ニコニコ実況過去ログAPI』から取得した場合はキャッシュは保存されません。

## JkTsGetterTool について
JkTsGetterTool.exe は、コマンドライン操作をしなくてもGUI操作で過去ログを取得できるツールです。JkTsGetter.exe と同じ場所に置いて起動してください。

### 過去ログ取得タブ
ニコニコ生放送、もしくは『ニコニコ実況過去ログAPI』から過去ログを取得します。このタブに .ts ファイルをドラッグ & ドロップすると、ファイルからチャンネル、開始日時、終了日時を取得できます。

### タイムシフト取得タブ
ニコニコ生放送から1日分 (午前4時～翌午前4時) の過去ログを取得します。このタブに .ts ファイルをドラッグ & ドロップすると、ファイルからチャンネル、日付を取得できます。

### ツールタブ
2つのxmlファイルを、時間で並べ替えつつ1つのファイルに統合できます。

### その他タブ
ニコニコ実況のサイトを開いたり、このツールのバージョン情報が載っていたりします。

## 免責事項
このツールは自己責任でご使用ください。万が一バグによってファイルを上書きしたり、タイムシフトコメントの取得をミスったりしても開発者は責任を負うことはできません。

## 最新版
このツールの最新版は以下で頒布しています。

https://github.com/sasukekinniku/JkTsGetterTool

## 更新履歴

### Ver.1.0.0.0 (202/12/23)
- 初回リリース
